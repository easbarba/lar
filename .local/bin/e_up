#!/usr/bin/env bash

# DEBUG OPTIONS
set -euo pipefail

DEPS=(sudo grep cut tr distro floss cejo emacs parallel cp find guix)
e_checkdeps "${DEPS[@]}"

DISTRO=$(grep '^NAME=' /etc/os-release | cut -f2 -d"=" | tr -d '"')

e_echo "Upgrading system."
distro update
distro upgrade

e_guix

e_echo "FLOSS projects"
floss grab
floss archive
find ~/Downloads/archived -name "*.tar" | parallel --max-args=1 cp -rpv {1} /media/$USER/MACHO/dots

e_doom
e_ruby
e_js

e_echo "Building Nightly Emacs"
[[ $DISTRO != "Arch Linux" ]] && cejo project emacs
