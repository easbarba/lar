#!/usr/bin/env ruby

# frozen_string_literal: true

# Manage System backlight.
class Backlight
  attr_reader :state, :brighters

  def initialize(state, brighters)
    @state = state.to_sym
    @brighters = brighters
  end

  def brighter
    brighters.first
  end

  def action(act)
    case act
    when :up
      brighter.up
    when :down
      brighter.down
    end
  end

  def final_command
    "#{brighter.bin} #{action(state)}"
  end

  def run
    return if %w[up down].include? state

    system final_command
  end
end

# all available backlight managers
class Brighters
  STEP = 5
  Brighter = Struct.new(:bin, :up, :down)

  def brightnessctl
    Brighter.new 'brightnessctl', "set #{STEP}%+", "set #{STEP}%-"
  end

  def all
    [brightnessctl]
  end
end

# RUN
Backlight.new(ARGV.first, Brighters.new.all).run
