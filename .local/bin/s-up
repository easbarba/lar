#!/usr/bin/env bash

# DEBUG SETTINGS
set -euo pipefail

DISTRO="$(awk '/^NAME=/ { split($0,a,"="); print a[2] }' /etc/os-release)"
DEPS=(sudo zae qas)

# * CHECKER
s-checkdeps "${DEPS[@]}"

# * TASKS
_system() {
    s-echo "Upgrading $DISTRO system packages."

    [[ -x $(command -v zae) ]] && zae update && zae upgrade && return
    [[ -x $(command -v apt) ]] && sudo apt update && sudo apt upgrade
}

_editors() {
    s-echo "Editors and Langs packages"

    s-doom
}

_langs() {
    s-echo "Languages package installers"

    s-ruby
    s-golang
    s-javascript
}

_packers() {
    s-echo "Foreign installers"

    s-guix
    s-flatpak
}

_user() {
    s-echo "User tasks"

    qas --grab
    qas --archive lar,annotations,mx,rake # TODO: save to usb-stick
}

# * RUN
_system
_editors
_langs
_packers
_user
