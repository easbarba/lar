#!/usr/bin/env bash

# debug options
set -euo pipefail

# ===========================
# VARIABLES
QUICKLISP=quicklisp.lisp
QUICKLISP_LOCATION="/tmp/$QUICKLISP"
SBCL_LOCATION="$HOME/Builds/sbcl"

# ===========================
# SBCL INSTALL
git clone git://git.code.sf.net/p/sbcl/sbcl "$SBCL_LOCATION"
export -n SBCL_HOME
cd "$SBCL_LOCATION"
sh make.sh --fancy --prefix="${HOME}/.local/bin"

# ===========================
# QUICKLISP INSTALL
[[ ! -f $QUICKLISP_LOCATION ]] && wget -c https://beta.quicklisp.org/quicklisp.lisp -P /tmp

# ===========================
# STUMPWM INSTALL

sbcl --no-sysinit --no-userinit --load "$QUICK_LOCATION" \
    --eval '(quicklisp-quickstart:install)' \
    --eval "(ql:quickload '(:quicklisp-slime-helper :clx :cl-ppcre :alexandria))" \
    --eval "(ql:quickload '(:xembed :xml-emitter :dbus :prove :swank))" \
    --eval "(quit)"
