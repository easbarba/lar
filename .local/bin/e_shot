#!/usr/bin/env bash
# frozen_string_literal: true

# Take a shot of the marvelous screen
class Screenshot
  PREFERRED_FORMAT = 'png'
  SHOTTERS_FOLDER = Pathname.new(Dir.home).join('.config', 'gota', 'screenshot')
  FOLDER = Pathname.new(Dir.home).join('Pictures')
  CURRENT_TIME = Time.new.strftime '%d-%m-%y-%I-%M'

  attr_reader :utils, :mode

  def initialize(mode)
    @mode = mode.to_sym if mode
  end

  def shotters
    Shotters.all
  end

  def shotters_available
    shotters.find_all do |shotter|
      sh = shotter[1]
      sh[:bin] if utils.which? sh[:bin]
    end
  end

  def shotter
    shotters_available.first[1]
  end

  def screenshot_name
    "screenshot-#{CURRENT_TIME}.#{PREFERRED_FORMAT}"
  end

  def final_command
    "#{shotter[:bin]} #{shotter[mode]} #{eval shotter[:folder]}"
  end

  def run
    return if %w[full partial].include? mode

    system final_command
  end
end

# All available shotters
class Shotters
  S = Struct.new(:bin, :full, :partial, :folder)

  #  scrot - command line screen capture utility
  def scrot
    S.new 'scrot', '--focused --silent', '--select --silent', 'FOLDER.join(screenshot_name)'
  end

  def maim
    S.new 'maim', '', '--select', 'FOLDER.join(screenshot_name)'
  end

  def flameshot; end

  # list of shotters
  def all
    [scrot]
  end
end

# RUN
Gota::Backlight.new(ARGV.first).run
