#!/usr/bin/env bash
set -euo pipefail

DISTRO="$(awk '/^NAME=/ { split($0,a,"="); print a[2] }' /etc/os-release)"
DEPS=(sudo distro floss)

# * CHECKER
e-checkdeps "${DEPS[@]}"

# * TASKS
_distro() {
    e-echo "Upgrading $DISTRO system and user packages."

    distro update
    distro upgrade
    e-guix
}

_packagers() {
    e-echo "Editors and Langs packages"

    e-doom
    e-ruby
}

_user() {
    e-echo "FLOSS projects"
    floss grab
    floss archive

    e-usb_tasks
}

e-nix() {
    [[ $DISTRO == "NixOS" ]] && nix-channel --update
}

# * RUN
_distro
_packagers
_user
