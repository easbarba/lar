#!/usr/bin/guile \
-e main -s
!#

(import (rnrs base)
        (rnrs io ports)
        (rnrs io simple))

(define home (getenv "HOME"))
(define dotsignore-filename ".dotsignore")

(define (dotsignore-exist? file)
  (file-exists? file))
(define (dotsignore root)
  (string-append root "/" dotsignore-filename))

(define (ignored-files root)
  (let* ((listed (string-split
                  (call-with-input-file (dotsignore root) get-string-all)
                  #\newline))
         (all (cons ".git" (cons ".dotsignore" listed))))
    (map (lambda (file)(string-append root "/" file)) all)))

(define (info root)
  (display (string-append "root: " root))
  (newline)
  (display (string-append
            "dotsignore: " (dotsignore root)
            " - found? " (if (dotsignore-exist? root) "yep" "nope"))))

(define (main args)
  (let ((root (canonicalize-path (cadr args))))
    (display (ignored-files root))))
