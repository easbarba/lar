#!/usr/bin/env bash

# Debug Options
set -euo pipefail

EMAIL="$USER@outlook.com"
KEY_LOCATION="$HOME/.ssh/id_ed25519"

_newkey() {
    ssh-keygen -t ed25519 -C $EMAIL
}

_startagent() {
    eval "$(ssh-agent -s)"
}

_addkey() {
    ssh-add "$KEY_LOCATION"
}

# * RUN
_protect() {
    # chmod 700 $HOME/.ssh
    # chmod 600 $HOME/.ssh/known_hosts

    chmod 600 "$KEY_LOCATION"
    chmod 600 "$KEY_LOCATION".pub
}

newdefault() {
    # new port
    /usr/bin/sudo /usr/bin/sed -i "s/Port 22|Port 33/g"

    # Disable root
    /usr/bin/sudo /usr/bin/sed -i "PermitRootLogin no"

    # limit users acess
    /usr/bin/sudo /usr/bin/sed -i "AllowUsers username"

    # use protocol 2
    /usr/bin/sudo /usr/bin/sed -i "Protocol 2"
}

_newkey
_startagent
_protect
_addkey
