#!/usr/bin/env bash

# Debug Options
set -euo pipefail

# Sourcing
source "$HOME/.asdf/completions/asdf.bash"
source "$HOME/.asdf/asdf.sh"

nodejs()
{
    # https://github.com/asdf-vm/asdf-nodejs

    [[ -f "$HOME/.asdf/shims/node" ]] && return

    echo 'Installing nodejs binaries'

    asdf plugin-add nodejs https://github.com/asdf-vm/asdf-nodejs.git

    bash -c '${ASDF_DATA_DIR:=$HOME/.asdf}/plugins/nodejs/bin/import-release-team-keyring'

    local $default=14.16.1
    asdf install nodejs $default

    asdf global nodejs $default
}

yarn()
{
    # https://github.com/asdf-vm/asdf-yarn

    # [[ -f "$HOME/.asdf/shims/yarn" ]] && return

    echo 'Installing Yarn binaries'

    asdf plugin-add yarn

    asdf install yarn latest

    asdf global yarn "$(asdf latest yarn)"
}

packages()
{
    echo 'Installing npm packages'

    local packages=(npm bash-language-server yaml-language-server vscode-json-languageserver)
    # eslint-config-airbnb-base parcel-bundler webpack-dev-server prettier gulp js-beautify typescript tern eslint eslint_d ionic babel pug webpack-cli dockerfile-language-server-nodejs generator-code indium gulp-pug browser-sync typescript-formatter vue-language-server eslint-plugin-import sass jshint pug-cli babel-preset-airbnb yo webpack is-website-vulnerable tldr vscode-html-languageserver-bin vscode-css-languageserver-bin typescript-language-server

    # install
    for pack in "${packages[@]}"
    do
	npm i -g "$pack"
    done
}

# * RUN

echo 'Nodejs - ASDF'

nodejs
yarn
packages
