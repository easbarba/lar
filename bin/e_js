#!/usr/bin/env bash

# Debug Options
set -euo pipefail

# Sourcing
source "$HOME/.asdf/completions/asdf.bash"
source "$HOME/.asdf/asdf.sh"

nodejs()
{
    # https://github.com/asdf-vm/asdf-nodejs

    add()
    {
	[[ -f "$HOME/.asdf/shims/node" ]] && return

	asdf plugin-add nodejs https://github.com/asdf-vm/asdf-nodejs.git

	bash -c '${ASDF_DATA_DIR:=$HOME/.asdf}/plugins/nodejs/bin/import-release-team-keyring'

    }

    install()
    {
	local default=14.16.1
	asdf install nodejs $default

	asdf global nodejs $default
    }

    add
    install

}

yarn()
{
    # https://github.com/asdf-vm/asdf-yarn

    add()
    {
	[[ -f "$HOME/.asdf/shims/yarn" ]] && return

	asdf plugin-add yarn

    }

    install()
    {
	asdf install yarn latest
	asdf global yarn "$(asdf latest yarn)"
    }

    add
    install
}

packages()
{
    local command='npm i'

    local essential=(npm typescript)
    local servers=(bash-language-server yaml-language-server
		   vscode-json-languageserver typescript-language-server
		   vscode-html-languageserver-bin vscode-css-languageserver-bin)
    local misc=(eslint-config-airbnb-base parcel-bundler
		webpack-dev-server prettier gulp js-beautify tern eslint eslint_d
		ionic babel pug webpack-cli dockerfile-language-server-nodejs
		generator-code indium gulp-pug browser-sync typescript-formatter
		vue-language-server eslint-plugin-import sass jshint pug-cli
		babel-preset-airbnb yo webpack is-website-vulnerable tldr)

    # * install
    e_dolist "$command" "${essential[@]}"
    e_dolist "$command" "${servers[@]}"
}

# * RUN

echo 'Nodejs - ASDF'

nodejs
yarn
packages
