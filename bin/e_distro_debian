#!/usr/bin/env bash

# set -e

# * DEBIAN

debian-upgrade()
{
    echo "-- Atualizando Sistema"

    sudo apt update
    sudo apt upgrade
    sudo apt autoremove
}

debian-packages ()
{
    essentials=(git p7zip p7zip-full zip unzip bash tmux zile gcc make build-essential curl emacs)

    programming=(shellcheck zenity libpq-dev bash-completion cmake postgresql sqlite3 libsqlite3-dev mercurial gdb clang clangd)

    user=(firefox libreoffice kdeconnect calibre inkscape screenkey kdenlive gimp obs-studio syncthing mpv libnotify-bin imagemagick pandoc screenfetch lm-sensors aspell aspell-pt-br steam plank rhythmbox)

    gtk=(numix-icon-theme numix-gtk-theme materia-gtk-theme adapta-gtk-theme)

    media=(ffmpeg vorbis-tools gstreamer1.0-plugins-bad gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-ugly)

    virtualization=(wine winetricks wine32 qemu qemu-system-gui qemu-utils qemu-efi qemu-kvm virt-manager ovmf)

    fonts=(fonts-firacode ttf-ancient-fonts fonts-nanum fonts-freefont-ttf fonts-dejavu)

    system=(screen neovim zsh fish unrar rar ripgrep lshw at usbutils lsof time net-tools iproute2 entr tree xsel xclip exuberant-ctags fontconfig libfreetype6 subversion bc gdebi htop strace ltrace ssh cpio lhasa lzop atool wmctrl poppler-utils linux-perf sysstat jq dialog ncdu nnn fzf fzy rsync bat rclone xonsh pv wget2 parallel locate info wget stow parted texinfo autoconf automake gnutls-bin bash-doc gcc-doc gdb-doc gdbserver nftables firewalld firewall-config socat vrms fzf)

    security=(gnutls-bin)

    laptop=(iw wireless-tools libiw-dev laptop-mode-tools i965-va-driver vainfo libvdpau-va-gl1 libinput-tools acpi acpid)

    debian=(apt-listbugs apt-listchanges reportbug aptitude apt-file)

    latex=(texlive-latex-recommended texlive-latex-extra texlive-latex-base)

    amd=(firmware-linux-nonfree libgl1-mesa-dri libglx-mesa0 mesa-vulkan-drivers xserver-xorg-video-all libglx-mesa0:i386 mesa-vulkan-drivers:i386 libgl1-mesa-dri:i386)
    echo "-- Debian Packages"

    echo "-- Habilita Multi-Arch"
    sudo dpkg --add-architecture i386

    echo "Instalando pacotes."
    local command='sudo apt install -y'

    e_foreach "$command" "${essentials[@]}"
    e_foreach "$command" "${programming[@]}"
    e_foreach "$command" "${system[@]}"
    e_foreach "$command" "${user[@]}"
    e_foreach "$command" "${gtk[@]}"
    e_foreach "$command" "${media[@]}"
    e_foreach "$command" "${virtualization[@]}"
    e_foreach "$command" "${fonts[@]}"; sudo fc-cache -fv
    sudo apt -y build-dep emacs
    e_foreach "$command" "${security[@]}"
    e_foreach "$command" "${laptop[@]}"
    e_foreach "$command" "${latex[@]}"
    e_foreach "$command" "${amd[@]}"
    e_foreach "$command" "${debian[@]}"; sudo apt-file update # update Debian database

    echo "Done"
}

debian-services()
{
    sudo timedatectl set-timezone America/Sao_Paulo
}

debian-foreign()
{
    chrome()
    {
        wget -P "$HOME/Downloads" https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb

        sudo apt install -y "$HOME/Downloads/google-chrome-stable_current_amd64.deb"
        sudo apt update
    }

    code()
    {
        cd ${HOME}
        wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > packages.microsoft.gpg
        sudo install -o root -g root -m 644 packages.microsoft.gpg /etc/apt/trusted.gpg.d/
        sudo sh -c 'echo "deb [arch=amd64 signed-by=/etc/apt/trusted.gpg.d/packages.microsoft.gpg] https://packages.microsoft.com/repos/vscode stable main" > /etc/apt/sources.list.d/vscode.list'

        sudo apt-get install -y apt-transport-https
        sudo apt-get update
        sudo apt install -y code
    }

    pgadmin()
    {
        # Install the public key for the repository (if not done previously):
        curl https://www.pgadmin.org/static/packages_pgadmin_org.pub | sudo apt-key add

        # Create the repository configuration file:
        sudo sh -c 'echo "deb https://ftp.postgresql.org/pub/pgadmin/pgadmin4/apt/buster pgadmin4 main" > /etc/apt/sources.list.d/pgadmin4.list && apt update'

        # Install for both desktop and web modes:
        sudo apt install pgadmin4 pgadmin4-desktop pgadmin4-web

        # Configure the webserver, if you installed pgadmin4-web:
        python -m pip install --user flask
        sudo /usr/pgadmin4/bin/setup-web.sh
    }

    chrome
    code
}

# * RUN

debian-upgrade
debian-packages
debian-services
# debian-foreign
