#!/usr/bin/env bash

# set -e

fedora-packages ()
{
    essentials=(zip unzip git tmux wget bash zile emacs)

    system=(p7zip p7zip-plugins openssh acpi lshw at usbutils lsof time net-tools iproute entr ntfs-3g tree xsel xclip ctags fontconfig freetype subversion bc htop strace ltrace cpio lzop atool wmctrl poppler-utils perf sysstat jq dialog ncdu ripgrep nnn fzf rsync bat rclone xonsh pv info stow screen autoconf texinfo firewall-config automake m4 libtool bzip2)

    programming=(ShellCheck zenity bash-completion cmake zsh fish gcc neovim gcc-c++ gdb clang clang-tools-extra lldb mercurial ncurses-devel)

    ruby=(openssl-devel python2 libyaml-devel libffi-devel readline-devel zlib-devel gdbm-devel)

    infra=(vagrant vagrant-libvirt VirtualBox qemu qemu-system-x86 qemu-kvm virt-manager wine) # podman edk2-ovmf

    user=(firefox kde-connect ImageMagick gimp pandoc libreoffice calibre inkscape krita atril liveusb-creator perl-File-MimeInfo aspell aspell-en syncthing lm_sensors xdg-utils dmenu xprop screenfetch numix-gtk-theme numix-icon-theme)

    fonts=(mozilla-fira-mono-fonts powerline-fonts google-noto-emoji-fonts google-noto-sans-fonts google-droid-sans-mono-fonts)

    media=(vorbis-tools gstreamer1-devel gstreamer1-plugins-base-tools gstreamer1-plugins-base-devel gstreamer1-plugins-good gstreamer1-plugins-good-extras gstreamer1-plugins-bad-free-devel gstreamer1-plugins-bad-free-extras)

    echo "Instalando pacotes."

    local command='sudo dnf install -y'

    e_foreach "$command ${essentials[@]}"
    e_foreach "$command ${ruby[@]}"
    e_foreach "$command ${programming[@]}"
    e_foreach "$command ${system[@]}"
    e_foreach "$command ${infra[@]}"
    e_foreach "$command ${user[@]}"
    e_foreach "$command ${fonts[@]}"; sudo fc-cache -fv
    e_foreach "$command ${media[@]}"
}

fedora-upgrade()
{
    sudo dnf upgrade -y
    sudo dnf autoremove -y
}

fedora-services()
{
    sudo hostnamectl set-hostname 'fedora'
}

fedora-foreign()
{
    rpmfusion()
    {
	# RPM FUSION
	if [ ! -x "$(command -v mpv)" ]; then
	    sudo dnf install -y https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm
	    sudo dnf install -y https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm

	    sudo dnf install -y ffmpeg mpv steam unrar
	fi
    }

    vscode()
    {
	if [ ! -x "$(command -v code)" ]; then
	    sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc
	    sudo sh -c 'echo -e "[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" > /etc/yum.repos.d/vscode.repo'

	    sudo dnf check-update -y
	    sudo dnf install -y code
	fi
    }

    docker()
    {
	echo 'docker'
    }

    podman()
    {
	echo 'podman'
    }

    rpmfusion
    podman
    vscode
    docker
}

# * RUN

fedora-upgrade
fedora-packages
# fedora-services
# fedora-foreign
