#!/usr/bin/env bash

# * Debug Options
set -euo pipefail

# * Information
# Site: https://guix.gnu.org/

# * ENV VARS
export GUIX_LOCPATH="$HOME/.guix-profile/lib/locale"

keys() {
	[[ -x $(command -v guix) ]] && return

	wget "https://sv.gnu.org/people/viewgpg.php?user_id=127547" -qO - | sudo -i gpg --import -
}

get() {
	[[ -x $(command -v guix) ]] && return

	local installer='https://git.savannah.gnu.org/cgit/guix.git/plain/etc/guix-install.sh'
	wget -P /tmp "$installer"
}

install() {
	[[ -x $(command -v guix) ]] && return

	sudo bash /tmp/guix-install.sh
}

update() {
	guix pull
	guix upgrade
}

locale() {
	local version=$(ls ~/.guix-profile/lib/locale/)
	guix install glibc-locales@"$version"
}

packages() {
	# Fix that annoying GUIX_LOCPATH warning

	local packages=(font-gnu-freefont-ttf font-dejavu fish nyxt icecat node)
	e_dolist "guix install" "${pack[@]}"
}

development() {
	# Fix that annoying GUIX_LOCPATH warning

	local packages=(node)
	e_dolist "guix install" "${pack[@]}"
}


# * RUN

keys
get
install
update

locale
packages
development
